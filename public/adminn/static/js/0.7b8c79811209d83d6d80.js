webpackJsonp([0],{SK5M:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("vLgD");var i={name:"ProjectConfig",props:{data:{type:Object,required:!0}},data:function(){var t=this.data;return{isSubmitting:!1,isModifyProject:!!t.project_id,actionName:t.project_id?"编辑":"新增",formData:{project_id:t.project_id,project_name:t.project_name||"",project_type:t.project_type||"",project_path:t.project_path||"",project_link:t.project_link||"",project_alisa:t.project_alisa||""},formRules:{project_name:[{required:!0,trigger:"blur",message:"请输入项目名称"},{trigger:"blur",validator:function(t,e,a){e.length>20?a("输入限制最多 20 个字符"):a()}}],project_path:[{required:!0,trigger:"blur",message:"请输入存储路径"},{trigger:"blur",validator:function(t,e,a){/^[0-9a-zA-Z]+$/.test(e)?a():a("只能包含英文字母和数字")}}],project_type:[{required:!0,message:"请选择项目类型"}]}}},computed:{downloadAddress:function(){var t=this.formData,e=location.protocol+"//"+location.host+"/app/"+(t.project_path||"[path]");return"ipa"!==t.project_type?e+".dn":"itms-services://?action=download-manifest&url="+e+"/describe.plist"}},methods:{handleSubmit:function(){var t=this;this.$refs.configForm.validate(function(e){var a;e&&(t.isSubmitting=!0,t.$mResponseHelper((a=t.formData,Object(o.a)(a.project_id?{url:"project/list/"+a.project_id,method:"put",data:a}:{url:"project/list",method:"post",data:a})),function(){t.$message.success(t.actionName+"成功"),t.$emit("notify",t.formData)}).finally(function(){t.isSubmitting=!1}))})}}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{"close-on-click-modal":!1,visible:"",center:""},on:{close:function(e){return t.$emit("notify")}}},[a("h4",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.actionName)+"项目")]),t._v(" "),a("el-form",{ref:"configForm",attrs:{model:t.formData,rules:t.formRules,id:"configForm","label-width":"120px"},nativeOn:{submit:function(e){return e.preventDefault(),t.handleSubmit(e)}}},[a("el-form-item",{attrs:{label:"项目名称：",prop:"project_name"}},[a("el-input",{attrs:{type:"text"},model:{value:t.formData.project_name,callback:function(e){t.$set(t.formData,"project_name","string"==typeof e?e.trim():e)},expression:"formData.project_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"存储路径：",prop:"project_path"}},[a("el-input",{attrs:{disabled:t.isModifyProject,type:"text"},model:{value:t.formData.project_path,callback:function(e){t.$set(t.formData,"project_path","string"==typeof e?e.trim():e)},expression:"formData.project_path"}},[a("el-popover",{attrs:{slot:"append",placement:"bottom-end",width:"340"},slot:"append"},[a("div",{staticClass:"el-popover__title"},[t._v("\n            APP下载地址：\n            "),a("copy-button",{attrs:{text:t.downloadAddress}},[t._v("复制")])],1),t._v(" "),a("el-button",{attrs:{slot:"reference",icon:"el-icon-question"},slot:"reference"}),t._v(" "),a("p",{staticClass:"text-breakword"},[t._v(t._s(t.downloadAddress))])],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"项目类型：",prop:"project_type"}},[a("el-radio-group",{attrs:{disabled:t.isModifyProject},model:{value:t.formData.project_type,callback:function(e){t.$set(t.formData,"project_type",e)},expression:"formData.project_type"}},[a("el-radio",{attrs:{label:"apk"}},[t._v(t._s(t._f("projectTypeName")("apk")))]),t._v(" "),a("el-radio",{attrs:{label:"ipa"}},[t._v(t._s(t._f("projectTypeName")("ipa")))])],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"项目链接：",prop:"project_link"}},[a("el-input",{attrs:{type:"url"},model:{value:t.formData.project_link,callback:function(e){t.$set(t.formData,"project_link","string"==typeof e?e.trim():e)},expression:"formData.project_link"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"名称备注：",prop:"project_alisa"}},[a("el-input",{attrs:{type:"text"},model:{value:t.formData.project_alisa,callback:function(e){t.$set(t.formData,"project_alisa","string"==typeof e?e.trim():e)},expression:"formData.project_alisa"}})],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{disabled:t.isSubmitting},on:{click:function(e){return t.$emit("notify")}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{loading:t.isSubmitting,type:"primary","native-type":"submit",form:"configForm"}},[t._v("确定")])],1)],1)},staticRenderFns:[]},n=a("C7Lr")(i,r,!1,null,null,null).exports,l={name:"ProjectUpload",props:{data:{type:Object,required:!0}},computed:{reqHeaders:function(){return{Authorization:this.$store.state.User.props.accessToken}}},data:function(){var t=this.data;return{isSubmitting:!1,isFileReady:!1,formData:{project_id:t.project_id,project_path:t.project_path,app_version:"",app_identifier:t.app_identifier||"",update_logs:"",is_force:!1},formRules:{app_version:[{trigger:"blur",required:!0,message:"请输入APP版本号"},{trigger:"blur",pattern:/^\d+(\.\d+)*$/,message:"格式错误"}],app_identifier:[{trigger:"blur",required:!0,message:"请输入签名标识"},{trigger:"blur",pattern:/^[0-9a-zA-Z]+(\.[0-9a-zA-Z]+)*$/,message:"格式错误"}]},uploadPath:"/admin/project/"+t.project_id+"/apps"}},methods:{handleSubmit:function(){var t=this;this.isFileReady?this.$refs.configForm.validate(function(e){e&&(t.isSubmitting=!0,t.$refs.appUpload.submit())}):this.$message.info("请选择上传文件")},handleUploaded:function(t){this.isSubmitting=!1,1e4==+t.code?(this.$message.success("上传成功"),this.$emit("notify",this.formData)):this.$message.error(t.emsg||"上传失败："+t)},handleChange:function(t,e){this.isFileReady=e.length>0},handleDisabled:function(){this.$message.error("只能同时上传一份文件！")}}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{"close-on-click-modal":!1,visible:"",center:""},on:{close:function(e){return t.$emit("notify")}}},[a("h4",{attrs:{slot:"title"},slot:"title"},[t._v("项目【"+t._s(t.data.project_name)+"】APP上传")]),t._v(" "),a("el-form",{ref:"configForm",attrs:{model:t.formData,rules:t.formRules,id:"configForm","label-width":"120px"},nativeOn:{submit:function(e){return e.preventDefault(),t.handleSubmit(e)}}},[a("el-form-item",[a("el-upload",{ref:"appUpload",attrs:{action:t.uploadPath,"auto-upload":!1,multiple:!1,limit:1,headers:t.reqHeaders,data:t.formData,"on-change":t.handleChange,"on-remove":t.handleChange,"on-success":t.handleUploaded,"on-error":t.handleUploaded,"on-exceed":t.handleDisabled,"with-credentials":"",drag:""}},[a("i",{staticClass:"el-icon-upload"}),t._v(" "),a("p",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),a("em",[t._v("点击上传")]),t._v("，大小不超过100MB")])])],1),t._v(" "),a("el-form-item",{attrs:{label:"APP版本号：",prop:"app_version"}},[a("el-input",{attrs:{type:"text",placeholder:"以点号[.]连接的数字序列"},model:{value:t.formData.app_version,callback:function(e){t.$set(t.formData,"app_version","string"==typeof e?e.trim():e)},expression:"formData.app_version"}})],1),t._v(" "),"ipa"===t.data.project_type?a("el-form-item",{attrs:{label:"签名标识：",prop:"app_identifier"}},[a("el-input",{attrs:{type:"text",placeholder:"以点号[.]连接的英文字母和数字组合"},model:{value:t.formData.app_identifier,callback:function(e){t.$set(t.formData,"app_identifier","string"==typeof e?e.trim():e)},expression:"formData.app_identifier"}})],1):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"更新日志：",prop:"update_logs"}},[a("el-input",{attrs:{rows:5,type:"textarea",placeholder:"说明：使用换行可插入多条记录"},model:{value:t.formData.update_logs,callback:function(e){t.$set(t.formData,"update_logs","string"==typeof e?e.trim():e)},expression:"formData.update_logs"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"强制更新：",prop:"is_force"}},[a("el-radio-group",{model:{value:t.formData.is_force,callback:function(e){t.$set(t.formData,"is_force",e)},expression:"formData.is_force"}},[a("el-radio",{attrs:{label:!1}},[t._v("否")]),t._v(" "),a("el-radio",{attrs:{label:!0}},[t._v("是")])],1)],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{disabled:t.isSubmitting},on:{click:function(e){return t.$emit("notify")}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{loading:t.isSubmitting,type:"primary","native-type":"submit",form:"configForm"}},[t._v("确定")])],1)],1)},staticRenderFns:[]},c=a("C7Lr")(l,s,!1,null,null,null).exports,p={name:"ProjectApps",props:{data:{type:Object,required:!0}},data:function(){return{isLoading:!0,appList:null,downloadPath:location.protocol+"//"+location.host+"/app/"}},created:function(){var t,e=this;this.$mResponseHelper((t=this.data.project_id,Object(o.a)({url:"project/"+t+"/apps",method:"get"})),function(t){e.appList=t.app_list}).finally(function(){e.isLoading=!1})},methods:{handleRemove:function(t){var e=this;this.$confirm("确定从列表中移除【"+t.app_file+"】吗？").then(function(){var a,i,r=e.appList;t.mLoading=!0,e.$set(r,r.indexOf(t),t),e.$mResponseHelper((a=e.data.project_id,i=t.id,Object(o.a)({url:"project/"+a+"/apps/"+i,method:"delete"})),function(){e.$message.success("删除成功"),t.mRemoved=!0,r.splice(r.indexOf(t),1)}).finally(function(){t.mLoading=!1,t.mRemoved||e.$set(r,r.indexOf(t),t)})}).catch(function(){})}}},d={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{visible:"",center:""},on:{close:function(e){return t.$emit("notify")}}},[a("h4",{attrs:{slot:"title"},slot:"title"},[t._v("项目【"+t._s(t.data.project_name)+"】的APP列表")]),t._v(" "),a("ol",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"lst-order"},t._l(t.appList,function(e,o){return a("li",{key:o,staticClass:"lst-item el-upload-list__item"},[a("p",{staticClass:"el-upload-list__item-name"},[t._v("\n        "+t._s(e.app_file)+"\n        "),a("copy-button",{attrs:{text:t.downloadPath+t.data.project_path+"/"+e.app_file}},[t._v("复制")])],1),t._v(" "),a("i",{staticClass:"el-icon-close",class:{"el-icon-loading":e.mLoading},on:{click:function(a){return t.handleRemove(e)}}})])}),0),t._v(" "),t.appList&&!t.appList.length?a("p",{staticClass:"el-upload__tip align-c"},[t._v("暂无数据")]):t._e(),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.$emit("notify")}}},[t._v("关闭")])],1)])},staticRenderFns:[]},u=a("C7Lr")(p,d,!1,null,null,null).exports,m={name:"ProjectIcon",props:{data:{type:Object,required:!0}},computed:{reqHeaders:function(){return{Authorization:this.$store.state.User.props.accessToken}},imagePath:function(){return"url("+(this.imageFileUrl||this.projectPath+"icon512.png")+")"}},data:function(){return{isSubmitting:!1,isFileReady:!1,imageFileUrl:null,uploadPath:"/admin/project/"+this.data.project_id+"/icon",projectPath:location.protocol+"//"+location.host+"/app/"+this.data.project_path+"/"}},methods:{handleSubmit:function(){this.isFileReady?this.$refs.iconUpload.submit():this.$message.info("请选择上传图片")},handleUploaded:function(t){this.isSubmitting=!1,1e4==+t.code?(this.$message.success("上传成功"),this.$emit("notify")):this.$message.error(t.emsg||"上传失败："+t)},handleChange:function(t,e){var a=this;if(this.isFileReady=!1,this.imageFileUrl&&(URL.revokeObjectURL(this.imageFileUrl),this.imageFileUrl=null),e.length>0){var o=new Image;o.onload=function(){512===o.width&&512===o.height?(a.isFileReady=!0,a.imageFileUrl=o.src):(a.$message.error("图片尺寸错误"),a.$refs.iconUpload.clearFiles())},o.onerror=function(){a.$message.error("图片文件错误"),a.$refs.iconUpload.clearFiles()},o.src=URL.createObjectURL(t.raw)}},handleDisabled:function(){this.$message.error("只能同时上传一张图片！")}}},f={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{"close-on-click-modal":!1,visible:"",center:""},on:{close:function(e){return t.$emit("notify")}}},[a("h4",{attrs:{slot:"title"},slot:"title"},[t._v("项目【"+t._s(t.data.project_name)+"】ICON上传")]),t._v(" "),a("el-upload",{ref:"iconUpload",staticClass:"el-upload--card",attrs:{action:t.uploadPath,"auto-upload":!1,multiple:!1,limit:1,headers:t.reqHeaders,"on-change":t.handleChange,"on-remove":t.handleChange,"on-success":t.handleUploaded,"on-error":t.handleUploaded,"on-exceed":t.handleDisabled,name:"image",accept:".jpg,.png,image/jpeg,image/png","with-credentials":""}},[a("div",{staticClass:"img-view",style:{backgroundImage:t.imagePath}}),t._v(" "),a("i",{staticClass:"el-icon-plus"}),t._v(" "),a("p",{staticClass:"el-upload__text"},[t._v("图片尺寸："),a("em",[t._v("512x512")])])]),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("a",{staticClass:"el-button el-button--success is-plain",attrs:{href:t.projectPath,target:"_blank"}},[t._v("预览")]),t._v(" "),a("el-button",{attrs:{disabled:t.isSubmitting},on:{click:function(e){return t.$emit("notify")}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{loading:t.isSubmitting,type:"primary"},on:{click:t.handleSubmit}},[t._v("确定")])],1)],1)},staticRenderFns:[]},_=a("C7Lr")(m,f,!1,null,null,null).exports,h={name:"ProjectSort",props:{list:{type:Array,required:!0}},data:function(){return{isSubmitting:!1,formData:{id_list:[]},formRules:{}}},computed:{projectList:function(){return this.list.map(function(t){return{key:t.project_id,label:t.project_name+" ("+t.project_alisa+")."+t.project_type}})}},methods:{handleSubmit:function(){var t,e=this;this.formData.id_list.length?(this.isSubmitting=!0,this.$mResponseHelper((t=this.formData,Object(o.a)({url:"project/sort",method:"post",data:t})),function(){e.$message.success("排序成功"),e.$emit("notify",e.formData)}).finally(function(){e.isSubmitting=!1})):this.$message.error("请至少选择一项作为排序依据")}}},g={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"m-transfer",attrs:{"close-on-click-modal":!1,title:"项目排序",visible:"",center:""},on:{close:function(e){return t.$emit("notify")}}},[a("el-transfer",{attrs:{data:t.projectList,titles:["项目列表","排序列表"],"target-order":"push"},model:{value:t.formData.id_list,callback:function(e){t.$set(t.formData,"id_list",e)},expression:"formData.id_list"}}),t._v(" "),a("p",{staticClass:"fc-tipe marg-t-text"},[t._v("规则说明：不在右侧“排序列表”的项目将按在左侧“项目列表”中的出现顺序追加到已排序项目后面。")]),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{disabled:t.isSubmitting},on:{click:function(e){return t.$emit("notify")}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{loading:t.isSubmitting,type:"primary"},on:{click:t.handleSubmit}},[t._v("确定")])],1)],1)},staticRenderFns:[]},v={name:"ProjcetList",components:{ProjectConfig:n,ProjectUpload:c,ProjectApps:u,ProjectIcon:_,ProjectSort:a("C7Lr")(h,g,!1,null,null,null).exports},data:function(){return{isLoading:!0,projectList:null,dialogType:0,projectData:{}}},created:function(){this.getProjectList()},methods:{getProjectList:function(){var t=this;this.isLoading=!0,this.$mResponseHelper(Object(o.a)({url:"project/list",method:"get"}),function(e){t.projectList=e.project_list}).finally(function(){t.isLoading=!1})},handleProject:function(t,e){this.dialogType=t,this.projectData=e},hanldeNotify:function(t){this.dialogType=0,t&&this.getProjectList()},handleRemove:function(t,e){var a=this,i=this.$createElement;this.$msgbox({title:"删除确认",message:i("div",null,[i("h4",{class:"fc-warn",style:"margin-bottom:8px;"},"确认删除项目【"+t.project_name+"】吗？"),i("p",{class:"fc-tipe"},"注意：项目所在服务器上的目录并没有被删除！只是在原有目录名后追加[.del]表示已删除。")]),showCancelButton:!0}).then(function(){var i,r=a.projectList;t.mLoading=!0,a.$set(r,e,t),a.$mResponseHelper((i=t.project_id,Object(o.a)({url:"project/list/"+i,method:"delete"})),function(){a.$message.success("删除成功"),t.mRemoved=!0,r.splice(r.indexOf(t),1)}).finally(function(){t.mLoading=!1,t.mRemoved||a.$set(r,r.indexOf(t),t)})}).catch(function(){})}}},b={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-form",{attrs:{inline:""}},[a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleProject(1,{})}}},[t._v("添加项目")]),t._v(" "),a("el-button",{attrs:{type:"success",plain:""},on:{click:function(e){return t.handleProject(9)}}},[t._v("项目排序")])],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],attrs:{data:t.projectList,stripe:""}},[a("el-table-column",{attrs:{type:"index",width:"50px"}}),t._v(" "),a("el-table-column",{attrs:{label:"项目名称",prop:"project_name","min-width":"190px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(e.row.project_name)+"\n        "),e.row.project_alisa?a("span",[t._v("("+t._s(e.row.project_alisa)+")")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"项目类型",prop:"project_type","min-width":"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("projectTypeName")(e.row.project_type)))]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"URL路径",prop:"project_path","min-width":"165px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(e.row.project_path)+"\n        "),e.row.project_link?a("a",{attrs:{href:e.row.project_link,target:"_blank"}},[t._v("链接")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"创建时间","min-width":"140px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateReadable")(e.row.create_time)))]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"APP更新","min-width":"140px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateReadable")(e.row.update_time)))]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"240px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{disabled:e.row.mLoading,type:"warning",size:"small",icon:"el-icon-edit",title:"编辑项目",circle:""},on:{click:function(a){return t.handleProject(1,e.row)}}}),t._v(" "),a("el-button",{attrs:{loading:e.row.mLoading,type:"danger",size:"small",icon:"el-icon-delete",title:"删除项目",circle:""},on:{click:function(a){return t.handleRemove(e.row,e.$index)}}}),t._v(" "),a("el-button",{attrs:{disabled:e.row.mLoading,type:"primary",size:"small",icon:"el-icon-upload",title:"上传APP",circle:""},on:{click:function(a){return t.handleProject(2,e.row)}}}),t._v(" "),a("el-button",{attrs:{disabled:e.row.mLoading,type:"success",size:"small",icon:"el-icon-goods",title:"APP列表",circle:""},on:{click:function(a){return t.handleProject(3,e.row)}}}),t._v(" "),"ipa"===e.row.project_type?a("el-button",{attrs:{disabled:e.row.mLoading,type:"info",size:"small",icon:"el-icon-picture",title:"上传图标",circle:""},on:{click:function(a){return t.handleProject(4,e.row)}}}):t._e()]}}])})],1),t._v(" "),1===t.dialogType?a("project-config",{attrs:{data:t.projectData},on:{notify:t.hanldeNotify}}):2===t.dialogType?a("project-upload",{attrs:{data:t.projectData},on:{notify:t.hanldeNotify}}):3===t.dialogType?a("project-apps",{attrs:{data:t.projectData},on:{notify:t.hanldeNotify}}):4===t.dialogType?a("project-icon",{attrs:{data:t.projectData},on:{notify:t.hanldeNotify}}):9===t.dialogType?a("project-sort",{attrs:{list:t.projectList},on:{notify:t.hanldeNotify}}):t._e()],1)},staticRenderFns:[]},j=a("C7Lr")(v,b,!1,null,null,null);e.default=j.exports}});